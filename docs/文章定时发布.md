# 1.文章定时发布
* redis实现：zset数据类型的去重有序（分数排序）特点进行延迟。例如：时间戳作为score进行排序

# 2.redis实现延迟任务思路：
![](/resources/延迟任务.png)

* Redis实现未来数据定时刷新，在引导类中添加开启任务调度注解：@EnableScheduling

# 3.分布式锁解决集群下的方法抢占执行
* 启动两台heima-leadnews-schedule服务，每台服务都会去执行refresh定时任务方法。
* 分布式锁：控制分布式系统有序的去对共享资源进行操作，通过互斥来保证数据的一致性。
* redis分布式锁：sexnx （SET if Not eXists） 命令在指定的 key 不存在时，为 key 设置指定的值。

![](/resources/分布式锁.png)

- 加锁的思路是：如果 key 不存在则为 key 设置 value，如果 key 已存在则 SETNX 命令不做任何操作。
    - 客户端A请求服务器设置key的值，如果设置成功就表示加锁成功。
    - 客户端B也去请求服务器设置key的值，如果返回失败，那么就代表加锁失败。
    - 客户端A执行代码完成，删除锁。
    - 客户端B在等待一段时间后再去请求设置key的值，设置成功。
    - 客户端B执行代码完成，删除锁。

# 4.延迟队列解决精准时间发布
* 在heima-leadnews-feign-api中，提供远程的feign接口。
* 在heima-leadnews-schedule微服务下提供对应的实现。